sap.ui.define(["sap/m/MessageToast"],function(o){"use strict";let e=false;let n=false;const t=[];let a=false;const l={loadGoogleMapsScript:function(o){return new Promise((a,l)=>{if(e&&window.google&&window.google.maps){console.log("Google Maps already loaded");a();return}if(n){console.log("Google Maps is loading, queueing callback");t.push(a);return}n=true;console.log("Starting to load Google Maps script...");const s=document.createElement("script");s.src=`https://maps.googleapis.com/maps/api/js?key=${o}&loading=async`;s.async=true;s.defer=true;s.onload=()=>{console.log("Google Maps script loaded successfully");e=true;n=false;a();t.forEach(o=>o());t.length=0};s.onerror=o=>{console.error("Failed to load Google Maps script:",o);n=false;l(new Error("Failed to load Google Maps script"))};document.head.appendChild(s);console.log("Google Maps script tag added to document")})},onMapContainerRendered:function(o){console.log("=== onMapContainerRendered called ===");if(a){console.log("Auto-load already triggered, skipping");return}a=true;const e=o.getSource();let n=0;const t=10;const s=()=>{console.log(`Auto-load attempt ${n+1}/${t}`);const o=e.getBindingContext();if(!o){n++;if(n<t){console.log("No binding context yet, retrying in 300ms...");setTimeout(s,300)}else{console.error("Failed to get binding context after max retries");const o=document.getElementById("mapPlaceholder");if(o){o.innerHTML='<p style="color: orange;">Data not available yet. Click Refresh Map to try again.</p>'}}return}const a=o.getObject();console.log("Step data retrieved:",a);if(!a){console.error("Binding context exists but no data");return}const r=parseFloat(a.startLat);const i=parseFloat(a.startLng);const g=parseFloat(a.endLat);const c=parseFloat(a.endLng);console.log("Coordinates:",{startLat:r,startLng:i,endLat:g,endLng:c});if(isNaN(r)||isNaN(i)||isNaN(g)||isNaN(c)){console.error("Invalid coordinates");const o=document.getElementById("mapPlaceholder");if(o){o.innerHTML='<p style="color: red;">Invalid coordinates</p>'}return}const d="AIzaSyBnJ6XNmu3vQE6Uay9BX7q1HV-Qz_N5eP4";console.log("Loading Google Maps...");l.loadGoogleMapsScript(d).then(()=>{console.log("Google Maps ready, rendering map...");setTimeout(()=>{l.renderMap(r,i,g,c,a)},200)}).catch(o=>{console.error("Error loading Google Maps:",o);const e=document.getElementById("mapPlaceholder");if(e){e.innerHTML='<p style="color: red;">Failed to load map. Click Refresh to retry.</p>'}})};setTimeout(s,100)},onRefreshMap:function(e){console.log("=== Refresh Map pressed ===");o.show("Refreshing map...");a=false;const n=e.getSource().getBindingContext();if(!n){o.show("No data available");return}const t=n.getObject();if(!t){o.show("No step data available");return}const s=parseFloat(t.startLat);const r=parseFloat(t.startLng);const i=parseFloat(t.endLat);const g=parseFloat(t.endLng);if(isNaN(s)||isNaN(r)||isNaN(i)||isNaN(g)){o.show("Invalid coordinates");const e=document.getElementById("mapPlaceholder");if(e){e.innerHTML='<p style="color: red;">Invalid coordinates</p>'}return}const c=document.getElementById("googleMap");if(c){c.innerHTML='<div id="mapPlaceholder" style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;color:#666;"><p>Refreshing map...</p></div>'}const d="AIzaSyBnJ6XNmu3vQE6Uay9BX7q1HV-Qz_N5eP4";l.loadGoogleMapsScript(d).then(()=>{setTimeout(()=>{l.renderMap(s,r,i,g,t)},100)}).catch(e=>{console.error("Error loading Google Maps:",e);o.show("Failed to load map: "+e.message)})},renderMap:function(e,n,t,a,l){console.log("=== renderMap called ===");console.log("Coordinates:",{startLat:e,startLng:n,endLat:t,endLng:a});const s=document.getElementById("googleMap");if(!s){console.error("Map container #googleMap not found in DOM");console.log("Available elements:",document.querySelectorAll('[id*="googleMap"]'));o.show("Map container not found");return}console.log("Map container found:",s);console.log("Container dimensions:",s.offsetWidth,"x",s.offsetHeight);console.log("Container parent:",s.parentElement);console.log("Container visibility:",window.getComputedStyle(s).display);if(!window.google){console.error("window.google not available");o.show("Google Maps API not loaded (window.google missing)");return}if(!window.google.maps){console.error("window.google.maps not available");o.show("Google Maps API not loaded (google.maps missing)");return}console.log("Google Maps API is available");console.log("google.maps.Map exists?",typeof google.maps.Map);console.log("google.maps.Marker exists?",typeof google.maps.Marker);try{const o=(e+t)/2;const r=(n+a)/2;console.log("Center point:",{centerLat:o,centerLng:r});const i={center:{lat:o,lng:r},zoom:14,mapTypeId:"roadmap"};console.log("Creating map with SIMPLIFIED options:",i);const g=document.getElementById("mapPlaceholder");if(g){g.remove()}const c=new google.maps.Map(s,i);console.log("Map created successfully:",c);console.log("Map div:",c.getDiv());s.style.display="block";s.style.position="relative";s.style.overflow="hidden";setTimeout(()=>{google.maps.event.trigger(c,"resize");c.setCenter({lat:o,lng:r});console.log("Map resize triggered")},100);const d=new google.maps.Marker({position:{lat:e,lng:n},map:c,title:"Start",label:"A",icon:{url:"http://maps.google.com/mapfiles/ms/icons/green-dot.png"}});console.log("Start marker added");const p=new google.maps.Marker({position:{lat:t,lng:a},map:c,title:"End",label:"B",icon:{url:"http://maps.google.com/mapfiles/ms/icons/red-dot.png"}});console.log("End marker added");const m=new google.maps.Polyline({path:[{lat:e,lng:n},{lat:t,lng:a}],geodesic:true,strokeColor:"#4285F4",strokeOpacity:.8,strokeWeight:4});m.setMap(c);console.log("Polyline added");const u=new google.maps.InfoWindow({content:`<div style="padding:5px;">\n                        <strong>Start Point</strong><br/>\n                        Step ${l.stepNumber||"N/A"}<br/>\n                        Lat: ${e.toFixed(6)}<br/>\n                        Lng: ${n.toFixed(6)}\n                    </div>`});d.addListener("click",function(){u.open(c,d)});const f=new google.maps.InfoWindow({content:`<div style="padding:5px;">\n                        <strong>End Point</strong><br/>\n                        ${l.instruction||"No instruction"}<br/>\n                        Distance: ${l.distance||"N/A"}<br/>\n                        Duration: ${l.duration||"N/A"}<br/>\n                        Lat: ${t.toFixed(6)}<br/>\n                        Lng: ${a.toFixed(6)}\n                    </div>`});p.addListener("click",function(){f.open(c,p)});const M=new google.maps.LatLngBounds;M.extend({lat:e,lng:n});M.extend({lat:t,lng:a});c.fitBounds(M);console.log("Google Map rendered successfully")}catch(e){console.error("Error creating map:",e);o.show("Error creating map: "+e.message)}}};return l});
//# sourceMappingURL=DisplayGmap.js.map